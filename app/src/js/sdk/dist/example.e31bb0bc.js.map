{"version":3,"sources":["../src/events.js","../src/framecom.js","../src/index.js","index.js"],"names":["Events","_on_cb","type","cbs","ncb","length","c","cb","once","splice","push","settings","url","container","document","body","height","width","params","style","backgroundColor","resize","border","maxHeight","maxWidth","FrameManager","opt","Object","assign","_url","_req","init","reqCounter","setUrl","build","setParams","render","initListener","removeListener","iframe","remove","createElement","s","appendChild","URL","src","p","i","setParam","key","value","searchParams","set","request","contentWindow","postMessage","JSON","stringify","_msg_handler","handleWorkerMessage","bind","window","addEventListener","removeEventListener","msg","parse","data","fire","idRequest","req","find","r","id","reqPos","indexOf","onResponse","result","e","console","error","idResolver","fw","Promise","resolve","post","res","settingsWorker","resolvers","FrameWorker","parent","handleManagerMessage","resolver","Function","then","catch","MxSdk","MxSdkWorker","mxsdk","on","ask","log","setTimeout"],"mappings":"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","file":"example.e31bb0bc.js","sourceRoot":"../example","sourcesContent":["/**\n* Simple event management\n* @example \n*     var e = new Events(); \n*     e.on('test',()=>{console.log('ok')});\n*     e.fire('test') -> 'ok'\n*      \n*/\nclass Events {\n  constructor() {\n    this._on_cb = [];\n  }\n  fire(type) {\n    var cbs = this._on_cb;\n    var ncb = cbs.length;\n    while (ncb) {\n      var c = cbs[ncb-1];\n      if (c.type === type) {\n        c.cb();\n        if (c.once) {\n          cbs.splice(ncb, 1);\n        }\n      }\n      ncb--;\n    }\n  }\n  on(type, cb) {\n    this._on_cb.push({\n      type: type,\n      cb: cb,\n      once: false\n    });\n  }\n  off(type, cb) {\n    var cbs = this._on_cb;\n    var ncb = cbs.length;\n    while (ncb) {\n      var c = cbs[ncb];\n      if (c.type === type && c.cb === cb) {\n        cbs.splice(ncb, 1);\n      }\n      ncb--;\n    }\n  }\n  once(type, cb) {\n    this._on_cb.push({\n      type: type,\n      cb: cb,\n      once: true\n    });\n  }\n}\n\nexport {Events};\n","import {Events} from './events.js';\n\nconst settings = {\n  url: 'http://localhost:80',\n  container: document.body,\n  height: 400,\n  width: 800,\n  params: {},\n  style: {\n    width: '810px',\n    height: '410px',\n    backgroundColor: '#474747',\n    resize: 'both',\n    border: 'none',\n    maxHeight: '100%',\n    maxWidth: '100%'\n  }\n};\n\nclass FrameManager extends Events {\n  constructor(opt) {\n    super();\n    this.opt = Object.assign({}, settings, opt);\n    this._url = null;\n    this._req = [];\n    this.init();\n    this.reqCounter = 0;\n  }\n\n  init() {\n    this.setUrl();\n    this.build();\n    this.setUrl();\n    this.setParams();\n    this.render();\n    this.initListener();\n  }\n\n  destroy() {\n    this.removeListener();\n    this.iframe.remove();\n  }\n\n  build() {\n    this.iframe = document.createElement('iframe');\n    for (let s in this.opt.style) {\n      this.iframe.style[s] = this.opt.style[s];\n    }\n    this.opt.container.appendChild(this.iframe);\n  }\n\n  setUrl(url) {\n    this._url = new URL(url || this.opt.url);\n  }\n  get url() {\n    return this._url;\n  }\n  render() {\n    this.iframe.src = this.url;\n  }\n  setParams(params) {\n    var p = (this.opt.params = params || this.opt.params);\n    for (let i in p) {\n      this.setParam(i, p[i]);\n    }\n  }\n  setParam(key, value) {\n    this.url.searchParams.set(key, value);\n  }\n  post(request) {\n    this.iframe.contentWindow.postMessage(JSON.stringify(request), '*');\n  }\n  initListener() {\n    this._msg_handler = this.handleWorkerMessage.bind(this);\n    window.addEventListener('message', this._msg_handler);\n  }\n  removeListener() {\n    window.removeEventListener('message', this._msg_handler);\n  }\n  handleWorkerMessage(msg) {\n    try {\n      const request = JSON.parse(msg.data);\n      if (request === 'ready') {\n        this.fire('ready');\n      } else if (request.idRequest > -1) {\n        const req = this._req.find((r) => r.id === request.idRequest);\n        if (req) {\n          const reqPos = this._req.indexOf(req);\n          this._req.splice(reqPos, 1);\n          req.onResponse(request.result);\n        }\n      }\n    } catch (e) {\n      console.error('Failed to parse message:', e);\n    }\n  }\n  ask(idResolver, data) {\n    const fw = this;\n    return new Promise((resolve) => {\n      var request = {\n        id: fw.reqCounter++,\n        idResolver: idResolver,\n        data: data\n      };\n      fw.post(request);\n      request.onResponse = (res) => {\n        resolve(res);\n      };\n      fw._req.push(request);\n    });\n  }\n}\n\nconst settingsWorker = {\n  resolvers: {}\n};\n\nclass FrameWorker {\n  constructor(opt) {\n    this.opt = Object.assign({}, settingsWorker, opt);\n    this.init();\n  }\n  init() {\n    this.initListener();\n    this.post('ready');\n  }\n  destroy() {\n    this.removeListener();\n  }\n\n  post(data) {\n    window.parent.postMessage(JSON.stringify(data), '*');\n  }\n  initListener() {\n    this._msg_handler = this.handleManagerMessage.bind(this);\n    window.addEventListener('message', this._msg_handler, false);\n  }\n  removeListener() {\n    window.removeEventListener('message', this._msg_handler);\n  }\n  handleManagerMessage(msg) {\n    try {\n      const fw = this;\n      const request = JSON.parse(msg.data);\n      const idRequest = request.id;\n      const idResolver = request.idResolver;\n      const resolver = this.opt.resolvers[idResolver];\n      return new Promise((resolve) => {\n        if (resolver instanceof Function) {\n          const result = resolver(request.data);\n          resolve(result);\n        } else {\n          resolve(null);\n        }\n      })\n        .then((res) => {\n          fw.post({\n            idRequest: idRequest,\n            result: res\n          });\n        })\n        .catch((e) => console.error(e));\n    } catch (e) {\n      console.error('Failed to parse message:', e);\n    }\n  }\n}\n\nexport {FrameManager, FrameWorker};\n","import {FrameManager, FrameWorker} from './framecom.js';\n\nclass MxSdk extends FrameManager {\n  constructor(opt) {\n    super(opt);\n  } \n}\n\nclass MxSdkWorker extends FrameWorker {\n   constructor(opt){\n     super(opt);\n   }\n}\n\nexport {MxSdk, MxSdkWorker};\n","import {MxSdk} from '../src/index.js';\n\nconst mxsdk = new MxSdk({\n  //url:   'http://dev.mapx.localhost:8880/static.html?project=MX-HPP-OWB-3SI-3FF-Q3R&views=MX-T8GJQ-GIC8X-AHLA9&zoomToViews=true&lat=-4.087&lng=21.754&z=4.886'\n  url : 'http://dev.mapx.localhost:8880/?project=MX-HPP-OWB-3SI-3FF-Q3R&language=en'\n});\n\nmxsdk.on('ready', () => {\n   mxsdk.ask('get_views').then(r => console.log(r));\n   mxsdk.ask('get_ip').then(r => console.log(r));\n   setTimeout(()=>{\n     mxsdk.ask('set_project','MX-JZL-FJV-RLN-7OH-QLU');\n   }, 3000);\n\n});\n"]}