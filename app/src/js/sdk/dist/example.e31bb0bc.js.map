{"version":3,"sources":["../src/events.js","../src/settings.json","../src/framecom.js","../src/index.js","index.js"],"names":["Events","_on_cb","type","cbs","ncb","length","c","cb","once","splice","push","module","exports","FrameManager","opt","Object","assign","settings","_url","_req","init","reqCounter","setUrl","build","setParams","render","initListener","removeListener","iframe","remove","document","createElement","s","style","container","Element","querySelector","appendChild","url","URL","src","params","p","i","setParam","key","value","searchParams","set","request","contentWindow","postMessage","JSON","stringify","_msg_handler","handleWorkerMessage","bind","window","addEventListener","removeEventListener","msg","parse","data","fire","console","log","idRequest","req","find","r","id","reqPos","indexOf","onResponse","result","e","error","idResolver","fw","Promise","resolve","post","res","settingsWorker","resolvers","FrameWorker","isNested","parent","handleManagerMessage","resolver","Function","then","catch","MxSdk","MxSdkWorker","mxsdk","on","ask","setTimeout"],"mappings":"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","file":"example.e31bb0bc.js","sourceRoot":"../example","sourcesContent":["/**\n* Simple event management\n* @example \n*     var e = new Events(); \n*     e.on('test',()=>{console.log('ok')});\n*     e.fire('test') -> 'ok'\n*      \n*/\nclass Events {\n  constructor() {\n    this._on_cb = [];\n  }\n  fire(type) {\n    var cbs = this._on_cb;\n    var ncb = cbs.length;\n    while (ncb) {\n      var c = cbs[ncb-1];\n      if (c.type === type) {\n        c.cb();\n        if (c.once) {\n          cbs.splice(ncb, 1);\n        }\n      }\n      ncb--;\n    }\n  }\n  on(type, cb) {\n    this._on_cb.push({\n      type: type,\n      cb: cb,\n      once: false\n    });\n  }\n  off(type, cb) {\n    var cbs = this._on_cb;\n    var ncb = cbs.length;\n    while (ncb) {\n      var c = cbs[ncb];\n      if (c.type === type && c.cb === cb) {\n        cbs.splice(ncb, 1);\n      }\n      ncb--;\n    }\n  }\n  once(type, cb) {\n    this._on_cb.push({\n      type: type,\n      cb: cb,\n      once: true\n    });\n  }\n}\n\nexport {Events};\n","module.exports = {\n  \"url\": \"http://localhost:80\",\n  \"container\": \"body\",\n  \"params\": {},\n  \"style\": {\n    \"width\": \"810px\",\n    \"height\": \"410px\",\n    \"backgroundColor\": \"#474747\",\n    \"resize\": \"both\",\n    \"border\": \"none\",\n    \"maxHeight\": \"100%\",\n    \"maxWidth\": \"100%\"\n  }\n}\n;","import {Events} from './events.js';\nimport * as settings from './settings.json'; \n\nclass FrameManager extends Events {\n  constructor(opt) {\n    super();\n    this.opt = Object.assign({}, settings, opt);\n    this._url = null;\n    this._req = [];\n    this.init();\n    this.reqCounter = 0;\n  }\n\n  init() {\n    this.setUrl();\n    this.build();\n    this.setUrl();\n    this.setParams();\n    this.render();\n    this.initListener();\n  }\n\n  destroy() {\n    this.removeListener();\n    this.iframe.remove();\n  }\n\n  build() {\n    this.iframe = document.createElement('iframe');\n    for (let s in this.opt.style) {\n      this.iframe.style[s] = this.opt.style[s];\n    }\n    if(!(this.opt.container instanceof Element)){\n      this.opt.container = document.querySelector(this.opt.container);\n    }\n    this.opt.container.appendChild(this.iframe);\n  }\n\n  setUrl(url) {\n    this._url = new URL(url || this.opt.url);\n  }\n  get url() {\n    return this._url;\n  }\n  render() {\n    this.iframe.src = this.url;\n  }\n  setParams(params) {\n    var p = (this.opt.params = params || this.opt.params);\n    for (let i in p) {\n      this.setParam(i, p[i]);\n    }\n  }\n  setParam(key, value) {\n    this.url.searchParams.set(key, value);\n  }\n  post(request) {\n    this.iframe.contentWindow.postMessage(JSON.stringify(request), '*');\n  }\n  initListener() {\n    this._msg_handler = this.handleWorkerMessage.bind(this);\n    window.addEventListener('message', this._msg_handler);\n  }\n  removeListener() {\n    window.removeEventListener('message', this._msg_handler);\n  }\n  handleWorkerMessage(msg) {\n    try {\n      const request = JSON.parse(msg.data);\n      if (request === 'ready') {\n        this.fire('ready');\n        console.log('ready received');\n      } else if (request.idRequest > -1) {\n        const req = this._req.find((r) => r.id === request.idRequest);\n        if (req) {\n          const reqPos = this._req.indexOf(req);\n          this._req.splice(reqPos, 1);\n          req.onResponse(request.result);\n        }\n      }\n    } catch (e) {\n      console.error('Failed to parse message:', e);\n    }\n  }\n  ask(idResolver, data) {\n    const fw = this;\n    return new Promise((resolve) => {\n      var request = {\n        id: fw.reqCounter++,\n        idResolver: idResolver,\n        data: data\n      };\n      fw.post(request);\n      request.onResponse = (res) => {\n        resolve(res);\n      };\n      fw._req.push(request);\n    });\n  }\n}\n\nconst settingsWorker = {\n  resolvers: {}\n};\n\nclass FrameWorker {\n  constructor(opt) {\n    this.opt = Object.assign({}, settingsWorker, opt);\n    this.init();\n  }\n  init() {\n    if (this.isNested()) {\n      this.initListener();\n      this.post('ready');\n      console.log('ready posted');\n    }\n  }\n  isNested() {\n    return window.parent !== window;\n  }\n  destroy() {\n    this.removeListener();\n  }\n\n  post(data) {\n    window.parent.postMessage(JSON.stringify(data), '*');\n  }\n  initListener() {\n    this._msg_handler = this.handleManagerMessage.bind(this);\n    window.addEventListener('message', this._msg_handler, false);\n  }\n  removeListener() {\n    window.removeEventListener('message', this._msg_handler);\n  }\n  handleManagerMessage(msg) {\n    console.log(msg);\n    try {\n      const fw = this;\n      const request = JSON.parse(msg.data);\n      const idRequest = request.id;\n      const idResolver = request.idResolver;\n      const resolver = this.opt.resolvers[idResolver];\n      return new Promise((resolve) => {\n        if (resolver instanceof Function) {\n          const result = resolver(request.data);\n          resolve(result);\n        } else {\n          resolve(null);\n        }\n      })\n        .then((res) => {\n          fw.post({\n            idRequest: idRequest,\n            result: res\n          });\n        })\n        .catch((e) => console.error(e));\n    } catch (e) {\n      console.error('Failed to parse message:', e);\n    }\n  }\n}\n\nexport {FrameManager, FrameWorker};\n","import {FrameManager, FrameWorker} from './framecom.js';\nimport * as settings from './settings.json'; \n\nclass MxSdk extends FrameManager {\n  constructor(opt) {\n    super(opt);\n    this.opt = Object.assign({}, settings, opt);\n  } \n}\n\nclass MxSdkWorker extends FrameWorker {\n   constructor(opt){\n     super(opt);\n   }\n}\n\nexport {MxSdk, MxSdkWorker};\n","import {MxSdk} from '../src/index.js';\n\nconst mxsdk = new MxSdk({\n  //url:   'http://dev.mapx.localhost:8880/static.html?project=MX-HPP-OWB-3SI-3FF-Q3R&views=MX-T8GJQ-GIC8X-AHLA9&zoomToViews=true&lat=-4.087&lng=21.754&z=4.886'\n  url : 'http://dev.mapx.localhost:8880/?project=MX-HPP-OWB-3SI-3FF-Q3R&language=en'\n});\n\nmxsdk.on('ready', () => {\n   mxsdk.ask('get_views').then(r => console.log(r));\n   mxsdk.ask('get_ip').then(r => console.log(r));\n   setTimeout(()=>{\n     mxsdk.ask('set_project','MX-JZL-FJV-RLN-7OH-QLU');\n   }, 3000);\n\n});\n"]}